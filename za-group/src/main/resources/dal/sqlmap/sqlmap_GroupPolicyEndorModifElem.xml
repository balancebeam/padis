<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="PolicyEndorModifElem">

	<typeAlias alias="PolicyEndorModifElemDO" type="com.zhongan.core.group.dao.dataobject.GroupPolicyEndorModifElemDO" />

	<resultMap id="PolicyEndorModifElemDOResultMap" class="PolicyEndorModifElemDO">
		<result property="id" column="id" />
		<result property="policyId" column="policy_id" />
		<result property="channelId" column="channel_id" />
		<result property="productId" column="product_id" />
		<result property="endorsementNo" column="endorsement_no" />
		<result property="endorsementStatus" column="endorsement_status" />
		<result property="elemName" column="elem_name" />
		<result property="elemOldContent" column="elem_old_content" />
		<result property="elemNewContent" column="elem_new_content" />
		<result property="elemMetaId" column="elem_meta_id" />
		<result property="elemMetaInfo" column="elem_meta_info" />
		<result property="elemMetaType" column="elem_meta_type" />
		<result property="elemHandler" column="elem_handler" />
		<result property="elemOperateType" column="elem_operate_type" />
		<result property="targetType" column="target_type" />
		<result property="targetParentId" column="target_parent_id" />
		<result property="targetId" column="target_id" />
		<result property="targetAssistId" column="target_assist_id" />
		<result property="uwPremium" column="uw_premium" />
		<result property="changePremium" column="change_premium" />
		<result property="newSumInsured" column="new_sum_insured" />
		<result property="changeSumInsured" column="change_sum_insured" />
		<result property="creator" column="creator" />
		<result property="gmtCreate" column="gmt_created" />
		<result property="modifier" column="modifier" />
		<result property="gmtModified" column="gmt_modified" />
		<result property="isDeleted" column="is_deleted" />
	</resultMap>

	<insert id="insertPolicyEndorModifElem" parameterClass="PolicyEndorModifElemDO">
		INSERT INTO
		group_policy_endor_modif_elem(
			`id`,
			policy_id,
			`channel_id`,
			`product_id`,
			`endorsement_no`,
			`endorsement_status`,
			`elem_name`,
			`elem_old_content`,
			`elem_new_content`,
			`elem_meta_id`,
			`elem_meta_info`,
			`elem_meta_type`,
			`elem_handler`,
			`elem_operate_type`,
			`target_type`,
			`target_parent_id`,
			`target_id`,
			`target_assist_id`,
			`uw_premium`,
			`change_premium`,
			`new_sum_insured`,
			`change_sum_insured`,
			`creator`,
			`gmt_created`,
			`modifier`,
			`gmt_modified`,
			`is_deleted`
		)
		VALUES (
			#id#,
			#policyId#,
			#channelId#,
			#productId#,
			#endorsementNo#,
			#endorsementStatus#,
			#elemName#,
			#elemOldContent#,
			#elemNewContent#,
			#elemMetaId#,
			#elemMetaInfo#,
			#elemMetaType#,
			#elemHandler#,
			#elemOperateType#,
			#targetType#,
			#targetParentId#,
			#targetId#,
			#targetAssistId#,
			#uwPremium#,
			#changePremium#,
			#newSumInsured#,
			#changeSumInsured#,
			#creator#,
			now(),
			#modifier#,
			now(),
			'N'
		)
	</insert>
	
	<update id="updatePolicyEndorModifElem" parameterClass="PolicyEndorModifElemDO">
		UPDATE group_policy_endor_modif_elem t
		<dynamic prepend="SET">
        	t.`gmt_modified` = now(),  
			<isNotNull property="elemName" prepend=",">
				<![CDATA[
				  t.`elem_name` = #elemName#
			    ]]>
		    </isNotNull>
			<isNotNull property="elemOldContent" prepend=",">
				<![CDATA[
				  t.`elem_old_content` = #elemOldContent#
			    ]]>
		    </isNotNull>
			<isNotNull property="elemNewContent" prepend=",">
				<![CDATA[
				  t.`elem_new_content` = #elemNewContent#
			    ]]>
		    </isNotNull>
			<isNotNull property="elemMetaId" prepend=",">
				<![CDATA[
				  t.`elem_meta_id` = #elemMetaId#
			    ]]>
		    </isNotNull>
			<isNotNull property="elemMetaInfo" prepend=",">
				<![CDATA[
				  t.`elem_meta_info` = #elemMetaInfo#
			    ]]>
		    </isNotNull>
			<isNotNull property="elemMetaType" prepend=",">
				<![CDATA[
				  t.`elem_meta_type` = #elemMetaType#
			    ]]>
		    </isNotNull>
			<isNotNull property="elemHandler" prepend=",">
				<![CDATA[
				  t.`elem_handler` = #elemHandler#
			    ]]>
		    </isNotNull>
			<isNotNull property="elemOperateType" prepend=",">
				<![CDATA[
				  t.`elem_operate_type` = #elemOperateType#
			    ]]>
		    </isNotNull>
			<isNotNull property="targetType" prepend=",">
				<![CDATA[
				 t.`target_type` = #targetType#
			    ]]>
		    </isNotNull>
			<isNotNull property="targetParentId" prepend=",">
				<![CDATA[
				 t.`target_parent_id` = #targetParentId#
			    ]]>
		    </isNotNull>
			<isNotNull property="targetId" prepend=",">
				<![CDATA[
				  t.`target_id` = #targetId#
			    ]]>
		    </isNotNull>
			<isNotNull property="targetAssistId" prepend=",">
				<![CDATA[
				  t.`target_assist_id` = #targetAssistId#
			    ]]>
		    </isNotNull>
		    		<isNotNull property="uwPremium" prepend=",">
		        <![CDATA[  
		        t.uw_premium = #uwPremium#  
		        ]]>
			</isNotNull>
			<isNotNull property="changePremium" prepend=",">
		        <![CDATA[  
		        t.change_premium = #changePremium#  
		        ]]>
			</isNotNull>
			<isNotNull property="newSumInsured" prepend=",">
		        <![CDATA[  
		        t.new_sum_insured = #newSumInsured#  
		        ]]>
			</isNotNull>
			<isNotNull property="changeSumInsured" prepend=",">
		        <![CDATA[  
		        t.change_sum_insured = #changeSumInsured#  
		        ]]>
			</isNotNull>
			<isNotNull property="creator" prepend=",">
				<![CDATA[
				  t.`creator` = #creator#
			    ]]>
		    </isNotNull>
			<isNotNull property="modifier" prepend=",">
				<![CDATA[
				  t.`modifier` = #modifier#
			    ]]>
		    </isNotNull>
			<isNotNull property="isDeleted" prepend=",">
				<![CDATA[
				  t.`is_deleted` = #isDeleted#
			    ]]>
		    </isNotNull>
		    	<isNotNull property="endorsementStatus" prepend=",">
				<![CDATA[
				  t.`endorsement_status` = #endorsementStatus#
			    ]]>
		    </isNotNull>
		    
		    
		</dynamic>
		WHERE t.policy_id=#policyId# 
			 AND t.`endorsement_no` = #endorsementNo#
			 <isNotNull property="id" prepend="AND">
				<![CDATA[	
					t.`id` = #id#
				]]>
		 	</isNotNull>
	</update>
	
	
	<select id="queryPolicyEndorModifElem"   resultMap="PolicyEndorModifElemDOResultMap">
	<![CDATA[	
		SELECT 
			  t.`id`, 
			  t.policy_id, 
			  t.`channel_id`, 
			  t.`product_id`, 
			  t.`endorsement_no`, 
			  t.`endorsement_status`,
			  t.`elem_name`, 
			  t.`elem_old_content`, 
			  t.`elem_new_content`, 
			  t.`elem_meta_id`, 
			  t.`elem_meta_info`, 
			  t.`elem_meta_type`, 
			  t.`elem_handler`, 
			  t.`elem_operate_type`, 
			  t.`target_type`, 
			  t.`target_parent_id`, 
			  t.`target_id`, 
			  t.`target_assist_id`, 
			  t.uw_premium,
			  t.change_premium,
			  t.new_sum_insured,
			  t.change_sum_insured,
			  t.`creator`, 
			  t.`gmt_created`, 
			  t.`modifier`, 
			  t.`gmt_modified`, 
			  t.`is_deleted`

		FROM group_policy_endor_modif_elem t
		WHERE
			t.policy_id=#policyId#
		]]>
			<isNotNull property="id" prepend="AND">
		        <![CDATA[  
		        	t.`id` = #id#  
		        ]]>
			</isNotNull>
		
			<isNotNull property="endorsementNo" prepend="AND">
		        <![CDATA[  
		        	t.`endorsement_no` = #endorsementNo#  
		        ]]>
			</isNotNull>
				<isNotNull property="endorsementStatus" prepend="AND">
		        <![CDATA[  
		        	t.`endorsement_status` = #endorsementStatus#  
		        ]]>
			</isNotNull>
			<isNotNull property="elemName" prepend="AND">
				<![CDATA[	
					t.`elem_name` = #elemName#
				]]>
		 	</isNotNull>
		 	<isNotNull property="elemMetaType" prepend="AND">
		      <![CDATA[	
		      	t.`elem_meta_type` = #elemMetaType#
			  ]]>
		 	</isNotNull>
			<isNotNull property="elemMetaId" prepend="AND">
		      <![CDATA[	
		      	t.`elem_meta_id` = #elemMetaId#
			  ]]>
		 	</isNotNull>
			<isNotNull property="elemHandler" prepend="AND">
		      <![CDATA[	
		      	t.`elem_handler` = #elemHandler#
			  ]]>
		 	</isNotNull>
		 	<isNotNull property="targetType" prepend="AND">
		      <![CDATA[	
		      	t.`target_type` = #targetType#
			  ]]>
		 	</isNotNull>
		 	<isNotNull property="targetTypeList"  prepend="AND">
			      <![CDATA[	
			      	t.`target_type` in 
				  ]]>
		 		<iterate open="(" close=")" property="targetTypeList" conjunction="," >
			      <![CDATA[	
			      	#targetTypeList[]#
				  ]]>
		 		</iterate>
		 	</isNotNull>
		 	<isNotNull property="targetParentId" prepend="AND">
		      <![CDATA[	
		      	t.`target_parent_id` = #targetParentId#
			  ]]>
		 	</isNotNull>
			<isNotNull property="targetId" prepend="AND">
		      <![CDATA[	
		      	t.`target_id` = #targetId#
			  ]]>
		 	</isNotNull>
			<isNotNull property="targetAssistId" prepend="AND">
		      <![CDATA[	
		      	t.`target_assist_id` = #targetAssistId#
			  ]]>
		 	</isNotNull>
			<isNotNull property="elemOperateType" prepend="AND">
		      <![CDATA[	
		      	t.`elem_operate_type` = #elemOperateType#
			  ]]>
		 	</isNotNull>
		 	 <![CDATA[	
		 		AND t.`is_deleted` <> 'Y' 
			ORDER BY t.`id` desc
		 ]]>
	</select>
	
	<select id="countListByPolicyEndorModifElem" resultClass="java.lang.Integer">
	<![CDATA[	
		SELECT COUNT(id) AS num FROM group_policy_endor_modif_elem t
		WHERE
			t.policy_id=#policyId#
		]]>
			<isNotNull property="endorsementNo" prepend="AND">
		        <![CDATA[  
		        	t.`endorsement_no` = #endorsementNo#  
		        ]]>
			</isNotNull>
			<isNotNull property="endorsementStatus" prepend="AND">
		        <![CDATA[  
		        	t.`endorsement_status` = #endorsementStatus#  
		        ]]>
			</isNotNull>
			
			
			<isNotNull property="elemName" prepend="AND">
				<![CDATA[	
					t.`elem_name` = #elemName#
				]]>
		 	</isNotNull>
		 	<isNotNull property="elemMetaType" prepend="AND">
		      <![CDATA[	
		      	t.`elem_meta_type` = #elemMetaType#
			  ]]>
		 	</isNotNull>
			<isNotNull property="elemMetaId" prepend="AND">
		      <![CDATA[	
		      	t.`elem_meta_id` = #elemMetaId#
			  ]]>
		 	</isNotNull>
			<isNotNull property="elemHandler" prepend="AND">
		      <![CDATA[	
		      	t.`elem_handler` = #elemHandler#
			  ]]>
		 	</isNotNull>
		 	<isNotNull property="targetType" prepend="AND">
		      <![CDATA[	
		      	t.`target_type` = #targetType#
			  ]]>
		 	</isNotNull>
		 	<isNotNull property="targetTypeList"  prepend="AND">
			      <![CDATA[	
			      	t.`target_type` in 
				  ]]>
		 		<iterate open="(" close=")" property="targetTypeList" conjunction="," >
			      <![CDATA[	
			      	#targetTypeList[]#
				  ]]>
		 		</iterate>
		 	</isNotNull>
		 	<isNotNull property="endorsementStatusList"  prepend="AND">
			      <![CDATA[	
			      	t.`endorsement_status` in 
				  ]]>
		 		<iterate open="(" close=")" property="endorsementStatus" conjunction="," >
			      <![CDATA[	
			      	#endorsementStatus[]#
				  ]]>
		 		</iterate>
		 	</isNotNull>
		 	<isNotNull property="targetParentId" prepend="AND">
		      <![CDATA[	
		      	t.`target_parent_id` = #targetParentId#
			  ]]>
		 	</isNotNull>
			<isNotNull property="targetId" prepend="AND">
		      <![CDATA[	
		      	t.`target_id` = #targetId#
			  ]]>
		 	</isNotNull>
			<isNotNull property="targetAssistId" prepend="AND">
		      <![CDATA[	
		      	t.`target_assist_id` = #targetAssistId#
			  ]]>
		 	</isNotNull>
		 	 <![CDATA[	
		 		AND t.`is_deleted` <> 'Y' 
		 ]]>
	</select>
	
	
	
	
	
	
		<delete id="delete">
		delete from group_policy_endor_modif_elem t
	 
		WHERE t.policy_id=#policyId# 
		AND t.`endorsement_no` = #endorsementNo#
		
		 
		 <isNotNull property="endorsementStatus" prepend="AND">
		      <![CDATA[	
		      	t.`endorsement_status` = #endorsementStatus#
			  ]]>
		 	</isNotNull>
			 	<isNotNull property="elemOperateType" prepend="AND">
		      <![CDATA[	
		      	t.`elem_operate_type` = #elemOperateType#
			  ]]>
		 	</isNotNull>
		 	<isNotNull property="targetParentId" prepend="AND">
		      <![CDATA[	
		      	t.`target_parent_id` = #targetParentId#
			  ]]>
		 	</isNotNull>
		 		<isNotNull property="elemName" prepend="AND">
				<![CDATA[	
					t.`elem_name` = #elemName#
				]]>
		 	</isNotNull>
		  	<isNotNull property="targetTypeList"  prepend="AND">
			      <![CDATA[	
			      	t.`target_type` in 
				  ]]>
		 		<iterate open="(" close=")" property="targetTypeList" conjunction="," >
			      <![CDATA[	
			      	#targetTypeList[]#
				  ]]>
		 		</iterate>
		 	</isNotNull>
		 	
		   <isNotNull property="ids"  prepend="AND">
			      <![CDATA[	
			      	t.`id` in 
				  ]]>
		 		<iterate open="(" close=")" property="ids" conjunction="," >
			      <![CDATA[	
			      	#ids[]#
				  ]]>
		 		</iterate>
		 	</isNotNull>
		 		  	<isNotNull property="targetIds"  prepend="AND">
			      <![CDATA[	
			      	t.`target_id` in 
				  ]]>
		 		<iterate open="(" close=")" property="targetIds" conjunction="," >
			      <![CDATA[	
			      	#targetIds[]#
				  ]]>
		 		</iterate>
		 	</isNotNull>
			
	</delete>
	
	
	
	
	
	

</sqlMap>